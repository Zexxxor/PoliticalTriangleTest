<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<link href="./style.css" rel="stylesheet" type="text/css">
<title>Political Triangle | Three Telos Model</title>
<link rel="icon" type="image/x-icon" href="ThreeTelos-favicon.ico">
<link rel="shortcut icon" type="image/x-icon" href="ThreeTelos-favicon.ico">
</head>
<body>
<div class="content-wrapper">
<h1>Political Triangle | Three Telos Model</h1>
<hr>
<div id="result"></div>
<div class="triangle-wrapper">
  <img src="Треугольник-пустой-с-идеологиями.png" alt="Треугольник ценностей" class="triangle-bg">
  <svg class="triangle-overlay" viewBox="0 0 400 270">
    <polygon points="284.942,0 284.942,268 53.116,134" stroke="black" fill="none"/>
    <circle id="resultPoint" r="5" fill="red" />
  </svg>
</div>
<div class="triangle-wrapper">
  <img src="Треугольник-пустой-с-идеологиями.png" alt="Треугольник ценностей" class="triangle-bg">
  <svg class="triangle-overlay" viewBox="0 0 400 270">
    <polygon points="284.942,0 284.942,268 53.116,134" stroke="black" fill="none"/>
    <circle id="resultPointDuplicate" r="5" fill="red" />
  </svg>
</div>
</div>
<script>
document.addEventListener('DOMContentLoaded', () => {
  let data;
  const dataStr = localStorage.getItem('triangleResult');
  if (dataStr) {
    try {
      data = JSON.parse(dataStr);
    } catch (e) {
      data = null;
    }
  }
  if (!data) {
    const params = new URLSearchParams(window.location.search);
    const paramData = params.get('data');
    if (paramData) {
      try {
        const jsonStr = decodeURIComponent(escape(atob(paramData)));
        data = JSON.parse(jsonStr);
      } catch (e) {
        console.error('Failed to decode data parameter', e);
      }
    }
  }
  if (!data) {
    document.getElementById('result').textContent = 'Нет данных для отображения.';
    return;
  }
  const n_L1 = data.n_L1 || 0;
  const n_L2 = data.n_L2 || 0;
  const n_I1 = data.n_I1 || 0;
  const n_I2 = data.n_I2 || 0;
  const n_A1 = data.n_A1 || 0;
  const n_A2 = data.n_A2 || 0;
  const M_L1 = data.M_L1 || 0;
  const M_L2 = data.M_L2 || 0;
  const M_I1 = data.M_I1 || 0;
  const M_I2 = data.M_I2 || 0;
  const M_A1 = data.M_A1 || 0;
  const M_A2 = data.M_A2 || 0;
  const S_L = 2 * n_L1 + 4 * n_L2;
  const S_I = 2 * n_I1 + 4 * n_I2;
  const S_A = 2 * n_A1 + 4 * n_A2;
  const D_L = 2 * M_L1 + 4 * M_L2;
  const D_I = 2 * M_I1 + 4 * M_I2;
  const D_A = 2 * M_A1 + 4 * M_A2;
  const L = D_L ? S_L / D_L : 0;
  const I = D_I ? S_I / D_I : 0;
  const A = D_A ? S_A / D_A : 0;
  const L10 = Math.round(10 * L * 100) / 100;
  const A10 = Math.round(10 * A * 100) / 100;
  const I10 = Math.round(10 * I * 100) / 100;
  const res = document.getElementById('result');
  res.innerHTML = `Равенство: ${L10}, Абсолютизм: ${A10}, Индивидуализм: ${I10}`;
  const m = data.D_tot ? (S_L + S_I + S_A) / data.D_tot : 0;
  let Lp, Ip, Ap;
  if (L === 0 && I === 0 && A === 0) {
    Lp = 0.5; Ip = 0.5; Ap = 0;
  } else {
    const sum = L + I + A;
    const vL = L / sum;
    const vI = I / sum;
    const vA = A / sum;
    Lp = (1 - m) * 0.5 + m * vL;
    Ip = (1 - m) * 0.5 + m * vI;
    Ap = (1 - m) * 0 + m * vA;
  }
  const xPrime = 360 + 360 * (Ap - Lp);
  const yPrime = 415.692 + 207.846 * (Lp + Ap) - 415.692 * Ip;
  const coordX = 0.32198055555555556 * xPrime - 0.18589564709769092 * yPrime + 169.029;
  const coordY = 0.18611111111111112 * xPrime + 0.3223540505951522 * yPrime - 67.0;
  res.innerHTML += `<br/>Координаты: (${coordX.toFixed(3)}, ${coordY.toFixed(3)})`;
  const pointElem = document.getElementById('resultPoint');
  pointElem.setAttribute('cx', coordX);
  pointElem.setAttribute('cy', coordY);
});
</script>
</body>
</html>
