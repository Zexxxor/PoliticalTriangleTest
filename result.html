<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<link href="./style.css" rel="stylesheet" type="text/css">
<title>Political Triangle | Three Telos Model</title>
<link rel="icon" type="x-icon" href="icon.png">
<link rel="shortcut icon" type="x-icon" href="icon.png">
</head>
<body>
<div class="content-wrapper">
<h1>Political Triangle | Three Telos Model</h1>
<hr>
<div id="result"></div>
<div class="triangle-wrapper">
  <img src="Треугольник.png" alt="Треугольник ценностей" class="triangle-bg">
  <svg class="triangle-overlay" viewBox="0 0 400 270">
    <polygon points="284.942,0 284.942,268 53.116,134" stroke="black" fill="none"/>
    <circle id="resultPoint" r="5" fill="red" />
  </svg>
</div>
</div>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const params = new URLSearchParams(window.location.search);
  const paramData = params.get('data');
  let data;
  if (paramData) {
    try {
      const jsonStr = decodeURIComponent(escape(atob(paramData)));
      data = JSON.parse(jsonStr);
    } catch (e) {
      console.error('Failed to decode data parameter', e);
    }
  }
  if (!data) {
    const dataStr = localStorage.getItem('triangleResult');
    if (!dataStr) {
      document.getElementById('result').textContent = 'Нет данных для отображения.';
      return;
    }
    data = JSON.parse(dataStr);
  }
  const S_L = data.S_L;
  const S_R = data.S_R;
  const S_I = data.S_I;
  const S_max = data.S_max || (S_L + S_R + S_I);
  const res = document.getElementById('result');
  const lVal = S_max ? (S_L / S_max * 100) : 0;
  const rVal = S_max ? (S_R / S_max * 100) : 0;
  const iVal = S_max ? (S_I / S_max * 100) : 0;
  res.innerHTML = `Равенство: ${lVal.toFixed(1)}%, Абсолютизм: ${rVal.toFixed(1)}%, Индивидуализм: ${iVal.toFixed(1)}%`;
  const svgWidth = 400;
  const svgHeight = 270;
  const margin = 0;
  const maxSideByHeight = svgHeight - 2 * margin;
  const maxSideByWidth = (svgWidth - 2 * margin) * 2 / Math.sqrt(3);
  const side = Math.min(maxSideByHeight, maxSideByWidth);
  const height = side * Math.sqrt(3) / 2;
  const baseX = svgWidth / 2 + height / 3;
  const I = {x: baseX, y: margin};
  const A = {x: baseX, y: margin + side};
  const E = {x: baseX - height, y: margin + side / 2};
  const total = S_L + S_R + S_I;
  const wI = total ? S_I / total : 0;
  const wA = total ? S_R / total : 0;
  const wE = total ? S_L / total : 0;
  const coordX = wI * I.x + wA * A.x + wE * E.x;
  const coordY = wI * I.y + wA * A.y + wE * E.y;
  res.innerHTML += `<br/>Координаты: (${coordX.toFixed(3)}, ${coordY.toFixed(3)})`;
  const pointElem = document.getElementById('resultPoint');
  pointElem.setAttribute('cx', coordX);
  pointElem.setAttribute('cy', coordY);
});
</script>
</body>
</html>
